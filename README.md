# ExtrarrFin üé¨

> **‚ö†Ô∏è AI-Generated Project Warning**  
> This project was generated by AI in the spirit of "vibe coding" - an experimental approach to rapid development. While functional, the codebase may contain unconventional patterns, incomplete error handling, or areas that could benefit from refactoring.

**ExtrarrFin** is a Python tool that automates the download of special episodes (Season 0) for your monitored series in Sonarr, and extras content for movies in Radarr, using yt-dlp to search and download content from YouTube.

## ‚ú® Features

- üîç **Automatic detection**: Retrieves all monitored series with monitored Season 0
- üì∫ **YouTube download**: Uses yt-dlp to download special episodes from YouTube
- üéØ **Smart video matching**: Intelligent scoring system to find the best video match ([see scoring documentation](SCORING.md))
- üéØ **Jellyfin format**: Automatically names files according to Jellyfin-compatible format
- üèÉ **Dry-run mode**: Lists episodes without downloading them
- ‚ôªÔ∏è **Duplicate detection**: Avoids re-downloading existing files (`--force` option to override)
- üîÑ **Sonarr integration**: Automatically triggers a scan after download
- üé¨ **Radarr support**: Download extras content for movies (tag mode only)
- üéöÔ∏è **Filtering**: Ability to limit to a specific series with `--limit`
- ‚öôÔ∏è **Flexible configuration**: YAML file, environment variables or CLI arguments
- üìÇ **Directory mapping**: Support for remote execution with path mapping
- ‚è∞ **Schedule mode**: Automatic periodic downloads with configurable intervals
- üê≥ **Docker support**: Run in a container with Debian-based image
- üìù **Subtitle management**: Automatic download and conversion to SRT format
- üì∫ **STRM mode**: Create streaming files instead of downloading (saves disk space)
- üè∑Ô∏è **Tag mode**: Download behind-the-scenes videos based on Sonarr/Radarr tags ([see documentation](TAG_MODE.md))
- üßπ **Automatic cleanup**: Removes incomplete `.part` files after failed downloads
- üîç **NFO detection**: Identifies and helps fix missing metadata files

## ÔøΩ What Gets Downloaded?

ExtrarrFin targets **Season 0 episodes** (special episodes) from your Sonarr library based on specific criteria:

### Selection Criteria

An episode will be downloaded if **ALL** of the following conditions are met:

1. **‚úÖ Series is monitored** in Sonarr
   - The series must have its "Monitored" flag enabled

2. **‚úÖ Episode is monitored** in Season 0
   - Individual episodes must be marked as monitored
   - The entire season doesn't need to be monitored - only the specific episodes you want
   - This allows fine-grained control: you can monitor only specific specials

3. **‚úÖ Episode has no file**
   - The episode must not already have a file in Sonarr
   - Use `--force` flag to re-download existing files if needed

### What is Season 0?

Season 0 (also called "Specials") typically includes:
- üé¨ **Behind-the-scenes** footage
- üé§ **Interviews** with cast and crew
- üé≠ **Deleted scenes** and outtakes
- üì∫ **Pilot episodes** and unaired pilots
- üéâ **Holiday specials** and crossover episodes
- üé• **Featurettes** and making-of documentaries
- üì∞ **Recap episodes** and previews

### YouTube Search and Scoring Strategy

For each missing episode, ExtrarrFin searches YouTube using:

1. **First attempt**: `"Series Name" + "Episode Title"`
   - Example: "Breaking Bad Behind the Scenes"

2. **Fallback**: `"Episode Title"` only
   - Used if the first search returns no results
   - Example: "Behind the Scenes"

3. **Smart selection**: Uses an intelligent scoring system to select the best match
   - Analyzes title match, channel credibility, duration, quality, views, etc.
   - Only accepts videos above the configured minimum score
   - **üìñ [See detailed scoring documentation](SCORING.md)** for configuration and tuning

### Download Process

For each matched episode:
1. ‚¨áÔ∏è Downloads video from YouTube (best quality MP4)
2. üìù Downloads subtitles (configurable languages)
3. üé¨ Converts subtitles to SRT format
4. üíæ Saves as: `Series Name - S00E01 - Episode Title.mp4`
5. üìÅ Places in `/path/to/series/Specials/` folder
6. üîÑ Triggers Sonarr rescan (unless `--no-scan` flag is used)

### Example Workflow

```
Monitored series in Sonarr: "Breaking Bad"
‚îú‚îÄ Season 0 (Specials)
‚îÇ  ‚îú‚îÄ S00E01 "Pilot" ..................... [monitored, no file] ‚Üí ‚úÖ Will download
‚îÇ  ‚îú‚îÄ S00E02 "Inside Breaking Bad" ....... [monitored, no file] ‚Üí ‚úÖ Will download
‚îÇ  ‚îú‚îÄ S00E03 "Making of Season 1" ........ [NOT monitored] ...... ‚Üí ‚ùå Will skip
‚îÇ  ‚îî‚îÄ S00E04 "Deleted Scenes" ............ [monitored, has file] ‚Üí ‚ùå Will skip (already exists)
```

**Result**: Only episodes S00E01 and S00E02 will be downloaded.

## üé¨ Movie Extras (Radarr Support)

ExtrarrFin can also download extras content for movies using **tag mode** with Radarr (optional).

### Customizing Movie Extras Keywords

You can configure the list of keywords used for YouTube searches in tag mode for movies via the `movie_extras_keywords` section in your `config.yaml`:

```yaml
movie_extras_keywords:
  - "behind the scenes"
  - "making of"
  - "featurette"
  - "interviews"
  - "deleted scenes"
  - "bloopers"
  - "vfx"
  - "special effect"
  - "special effects"
  - "visual effect"
  - "visual effects"
  - "SFX"
  - "FX"
```

If not set, the default list is used (see config.example.yaml).

### How it works

1. **Tag your movies** in Radarr with the tag `want-extras` or `want_extras`
2. **Configure Radarr** in your config.yaml (URL and API key)
3. **Run in tag mode**: `python extrarrfin.py download -m tag`

### What gets downloaded

For each tagged movie, ExtrarrFin searches YouTube for all keywords in your configuration (see above). By default, this includes:
- üé¨ **Behind the scenes** footage
- üé• **Making of** documentaries
- üé§ **Interviews** and featurettes
- üé≠ **Deleted scenes**
- üòÇ **Bloopers** and gag reels
- üßë‚Äçüíª **VFX, SFX, FX, special/visual effects**

### Storage location

Movie extras are saved in an `extras/` folder within the movie directory:

```
/path/to/movies/
‚îî‚îÄ‚îÄ Movie Name (2023)/
    ‚îú‚îÄ‚îÄ Movie Name (2023).mp4          # Main movie file
    ‚îî‚îÄ‚îÄ extras/
        ‚îú‚îÄ‚îÄ Movie Name (2023) - Behind the Scenes.mp4
        ‚îú‚îÄ‚îÄ Movie Name (2023) - Making Of.mp4
        ‚îî‚îÄ‚îÄ Movie Name (2023) - Interviews.mp4
```

### Example

```
Tagged movie in Radarr: "Inception (2010)" with tag "want-extras"

ExtrarrFin will search YouTube for:
  ‚úÖ "Inception behind the scenes"
  ‚úÖ "Inception making of"
  ‚úÖ "Inception featurette"
  ‚úÖ "Inception interviews"
  ‚úÖ "Inception deleted scenes"
  ‚úÖ "Inception bloopers"
  ‚úÖ "Inception vfx"
  ‚úÖ "Inception special effect"
  ‚úÖ "Inception special effects"
  ‚úÖ "Inception visual effect"
  ‚úÖ "Inception visual effects"
  ‚úÖ "Inception SFX"
  ‚úÖ "Inception FX"

Results are saved to: /movies/Inception (2010)/extras/
```

**Note**: Radarr is entirely optional. If not configured, ExtrarrFin works normally with Sonarr only.

## üìö Documentation

- **[README.md](README.md)** (this file) - General documentation and usage guide
- **[SCORING.md](SCORING.md)** - Detailed scoring system documentation and configuration
- **[TAG_MODE.md](TAG_MODE.md)** - Tag mode for downloading behind-the-scenes content

## üìã Prerequisites

- Python 3.8+
- An operational Sonarr instance (required)
- Sonarr API access (API key)
- An operational Radarr instance (optional, for movies)
- Radarr API access (optional, API key)
- FFmpeg (for yt-dlp)

## üöÄ Installation

### Option 1: Standard Installation

```bash
# Clone the repository
git clone https://github.com/yourusername/extrarrfin.git
cd extrarrfin

# Install dependencies
pip install -r requirements.txt
```

### Option 2: Docker Installation

```bash
# Pull the image from Docker Hub
docker pull jeanmary/extrarrfin:latest

# Or use docker-compose (recommended)
# Create a docker-compose.yml file and run:
docker-compose up -d
```

### Installing system dependencies

```bash
# Ubuntu/Debian
sudo apt update
sudo apt install ffmpeg

# macOS
brew install ffmpeg

# Arch Linux
sudo pacman -S ffmpeg
```

## ‚öôÔ∏è Configuration

### Option 1: Configuration file (recommended)

Copy the example file and edit it:

```bash
cp config.example.yaml config.yaml
nano config.yaml
```

Example `config.yaml`:

```yaml
# === SONARR (TV Series) - Required ===
# Your Sonarr instance URL
sonarr_url: "http://localhost:8989"

# Sonarr API key
sonarr_api_key: "your_api_key_here"

# === RADARR (Movies) - Optional ===
# Only used for tag mode to download movie extras
# Leave empty to disable Radarr support
radarr_url: "http://localhost:7878"
radarr_api_key: "your_radarr_api_key_here"

# Jellyfin configuration (optional)
jellyfin_url: "http://localhost:8096"
jellyfin_api_key: "your_jellyfin_api_key_here"

# Directory where your media is located (optional)
media_directory: "/mnt/media/TV Shows"

# Root directory in Sonarr (optional)
sonarr_directory: "/tv"

# Root directory in Radarr (optional)
radarr_directory: "/movies"

# yt-dlp download format
yt_dlp_format: "bestvideo[ext=mp4]+bestaudio[ext=m4a]/best[ext=mp4]/best"

# YouTube search and scoring configuration (see SCORING.md for details)
youtube_search_results: 10  # Number of results to analyze (3-20)
min_score: 50.0             # Minimum score to accept a video match (40-80)

# Log level
log_level: "INFO"

# Mode: season0 (series only), tag (series + movies), or both
# season0: Downloads monitored Season 0 episodes from Sonarr
# tag: Downloads behind-the-scenes for series/movies with "want-extras" tag
mode: "season0"

# Schedule mode (optional)
schedule_enabled: false
schedule_interval: 6
schedule_unit: "hours"  # seconds, minutes, hours, days, weeks

# Subtitle configuration (optional)
subtitle_languages:
  - "fr"
  - "en"
  - "fr-FR"
  - "en-US"
  - "en-GB"
download_all_subtitles: false

# STRM file mode (optional)
# Creates .strm files instead of downloading - saves disk space
use_strm_files: false
```

### Option 2: Environment variables

You can also use a `.env` file (copy from `.env.example`):

```bash
cp .env.example .env
nano .env
```

Or export variables directly:

```bash
export SONARR_URL="http://localhost:8989"
export SONARR_API_KEY="your_api_key_here"
export RADARR_URL="http://localhost:7878"
export RADARR_API_KEY="your_radarr_api_key_here"
export JELLYFIN_URL="http://localhost:8096"
export JELLYFIN_API_KEY="your_jellyfin_api_key_here"
export MEDIA_DIRECTORY="/mnt/media/TV Shows"
export SONARR_DIRECTORY="/tv"
export RADARR_DIRECTORY="/movies"
export SUBTITLE_LANGUAGES="fr,en,es"
export DOWNLOAD_ALL_SUBTITLES="false"
export USE_STRM_FILES="false"
```

### Option 3: Command-line arguments

```bash
python extrarrfin.py --sonarr-url http://localhost:8989 --sonarr-api-key YOUR_KEY list

# With Radarr for movies support
python extrarrfin.py --sonarr-url http://localhost:8989 --sonarr-api-key YOUR_SONARR_KEY \
  --radarr-url http://localhost:7878 --radarr-api-key YOUR_RADARR_KEY list
```

## üìñ Usage

### Available commands

#### `test` - Test connection

```bash
python extrarrfin.py test

# Test with specific Jellyfin credentials
python extrarrfin.py test --jellyfin-url http://localhost:8096 --jellyfin-api-key YOUR_KEY
```

Verifies that the connection to Sonarr and Jellyfin (if configured) is working correctly.

**Example output:**
```
Testing Sonarr connection...
URL: http://localhost:8989
‚úì Connection successful!
Number of series: 42
Monitored series: 35
With monitored season 0 episodes: 12
With want-extras tag: 8

Testing Radarr connection...
URL: http://localhost:7878
‚úì Connection successful!
Number of movies: 156
Monitored movies: 145
With want-extras tag: 8

Testing Jellyfin connection...
URL: http://localhost:8096
‚úì Jellyfin connection successful!
Server: My Jellyfin Server
Version: 10.8.13
```

#### `list` - List series and movies

Displays detailed information about your Season 0 episodes and tagged extras including:
- üì∫ Media type (Series or Movie)
- üìä Number of downloaded episodes/extras
- üìä Number of missing episodes  
- üìù Subtitle count and languages (fr, en, etc.)
- üé¨ File type indicators (Video/STRM)

```bash
# List all series with monitored Season 0
python extrarrfin.py list

# List series and movies with want-extras tag
python extrarrfin.py list --mode tag

# List both Season 0 and tagged series/movies
python extrarrfin.py list --mode season0 --mode tag

# Limit to a specific series or movie (by name)
python extrarrfin.py list --limit "Breaking Bad"
python extrarrfin.py list --mode tag --limit "Inception"

# Limit to a specific series (by ID)
python extrarrfin.py list --limit 42
```

**Example output (Season 0 mode):**
```
Series with Monitored Season 0 (2)
‚îè‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îì
‚îÉ Type   ‚îÉ ID ‚îÉ Title         ‚îÉ Path                        ‚îÉ Downloaded ‚îÉ Missing ‚îÉ Subtitles  ‚îÉ Size   ‚îÉ
‚î°‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î©
‚îÇ üì∫ TV  ‚îÇ 42 ‚îÇ Breaking Bad  ‚îÇ /media/TV Shows/Breaking... ‚îÇ 5          ‚îÇ 2       ‚îÇ 5 en, 5 fr ‚îÇ 2.4 GB ‚îÇ
‚îÇ üì∫ TV  ‚îÇ 43 ‚îÇ The Office    ‚îÇ /media/TV Shows/The Offi... ‚îÇ 3          ‚îÇ 1       ‚îÇ 3 en       ‚îÇ 856 MB ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

Total size: 3.26 GB
```

**Example output (Tag mode with series and movies):**
```
Series & Movies with want-extras tag (5 items: 3 series, 2 movies)
‚îè‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îì
‚îÉ Type   ‚îÉ ID ‚îÉ Title         ‚îÉ Path                        ‚îÉ Downloaded ‚îÉ Missing ‚îÉ Subtitles  ‚îÉ Size   ‚îÉ
‚î°‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î©
‚îÇ üì∫ TV  ‚îÇ 42 ‚îÇ Breaking Bad  ‚îÇ /media/TV Shows/Breaking... ‚îÇ 8          ‚îÇ -       ‚îÇ 8 en, 8 fr ‚îÇ 1.2 GB ‚îÇ
‚îÇ üì∫ TV  ‚îÇ 43 ‚îÇ The Office    ‚îÇ /media/TV Shows/The Offi... ‚îÇ 5          ‚îÇ -       ‚îÇ 5 en       ‚îÇ 756 MB ‚îÇ
‚îÇ üé¨ Movie‚îÇ 12 ‚îÇ Inception     ‚îÇ /media/Movies/Inception...  ‚îÇ 6          ‚îÇ -       ‚îÇ 6 en       ‚îÇ 980 MB ‚îÇ
‚îÇ üì∫ TV  ‚îÇ 88 ‚îÇ Stranger Thi..‚îÇ /media/TV Shows/Stranger... ‚îÇ 10         ‚îÇ -       ‚îÇ 10 en      ‚îÇ 1.8 GB ‚îÇ
‚îÇ üé¨ Movie‚îÇ 45 ‚îÇ The Dark Kni..‚îÇ /media/Movies/The Dark K... ‚îÇ 7          ‚îÇ -       ‚îÇ 7 en       ‚îÇ 1.1 GB ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

Total size: 5.83 GB
```

#### `download` - Download episodes

> **üí° Note:** Incomplete `.part` files are now automatically cleaned up after failed downloads. No manual cleanup needed!

```bash
# Dry-run mode (simulation without downloading)
python extrarrfin.py download --dry-run

# Download all missing episodes
python extrarrfin.py download

# Download with automatic Jellyfin library refresh
python extrarrfin.py download --jellyfin-url http://localhost:8096 --jellyfin-api-key YOUR_KEY

# Limit to a specific series (by name or ID)
python extrarrfin.py download --limit "Breaking Bad"
python extrarrfin.py download --limit 42

# Target a specific episode number (requires --limit)
python extrarrfin.py download --limit "Breaking Bad" --episode 5

# Force re-download even if files exist
# This will delete and replace existing files
python extrarrfin.py download --force, scoring, and download info
# Very useful to understand which videos are selected and why
python extrarrfin.py download --verbose

# Combine options
python extrarrfin.py download --limit "Series" --episode 3 --force --verbose --dry-run
```

> **üí° Tip:** Use `--verbose` mode to see detailed scoring information for each video candidate. This helps understand why certain videos are selected or rejected. See [SCORING.md](SCORING.md) for more details.erbose mode - show detailed search and download info
python extrarrfin.py download --verbose

# Combine options
python extrarrfin.py download --limit "Series" --episode 3 --force --verbose --dry-run
```

**Example output:**
```
Processing: Breaking Bad

  Directory: /media/TV Shows/Breaking Bad/Specials
  
  Downloading: Breaking Bad - S00E01 - Pilot
    Search query: 'Breaking Bad Pilot'
    ‚úì Downloaded: /media/TV Shows/Breaking Bad/Specials/Breaking Bad - S00E01 - Pilot.mp4
    
  Downloading: Breaking Bad - S00E02 - Inside Breaking Bad
    Search query: 'Breaking Bad Inside Breaking Bad'
    ‚úì Downloaded: /media/TV Shows/Breaking Bad/Specials/Breaking Bad - S00E02 - Inside Breaking Bad.mp4
    
  Scanning Sonarr...
    ‚úì Scan triggered

Summary:
  Total: 2
  Success: 2
  Failed: 0 (with scoring details):**
```
Processing: Breaking Bad

  Directory: /media/TV Shows/Breaking Bad/Specials
  
  Downloading: Breaking Bad - S00E01 - Pilot
    Search query: 'Breaking Bad Pilot'
    [VERBOSE] Series network: AMC
    [VERBOSE] YouTube search query: 'Breaking Bad Pilot'
    [VERBOSE] Analyzing 10 candidates...
    
    [VERBOSE] Candidate 1: Breaking Bad: Pilot - Full Episode (Official)
    [VERBOSE]   Title match: +50.0 | Series: +20.0 | Network: +30.0 (AMC)
    [VERBOSE]   Duration: +20.0 (47 min) | Quality: +15.0 (official, hd)
    [VERBOSE]   Views: +10.0 (3.5M) | Resolution: +15.0 (1080p)
    [VERBOSE]   ‚Üí Score: 160.0 ‚úì
    
    [VERBOSE] Candidate 2: Breaking Bad Pilot Scene Compilation
    [VERBOSE]   Title match: +50.0 | Series: +20.0 | Duration: +20.0
    [VERBOSE]   Quality: -10.0 (clip) | Views: +5.0 | Resolution: +10.0
    [VERBOSE]   ‚Üí Score: 95.0 ‚úì
    
    [VERBOSE] Candidate 3: Breaking Bad Review and Analysis
    [VERBOSE]   Title match: +20.0 | Duration: +20.0 | Quality: -10.0 (review)
    [VERBOSE]   Views: +3.0 | Resolution: +10.0
    [VERBOSE]   ‚Üí Score: 43.0 ‚úó (below min_score: 50.0)
    
    [VERBOSE] Best match: Breaking Bad: Pilot - Full Episode (Official)
    [VERBOSE] Video URL: https://www.youtube.com/watch?v=...
    [VERBOSE] Match score: 160.0
    [VERBOSE] Starting download...
    ‚úì Downloaded: /media/TV Shows/Breaking Bad/Specials/Breaking Bad - S00E01 - Pilot.mp4
```

> **üìñ For detailed explanation of the scoring system**, see [SCORING.md](SCORING.md) [VERBOSE] Download successful: /media/.../Breaking Bad - S00E01 - Pilot.mp4
    [VERBOSE] File size: 1024.56 MB
    ‚úì Downloaded: /media/TV Shows/Breaking Bad/Specials/Breaking Bad - S00E01 - Pilot.mp4
```

#### `scan` - Manual scan

```bash
# Trigger a manual scan for a series
python extrarrfin.py scan 42

# Dry-run mode (simulate without scanning)
python extrarrfin.py scan 42 --dry-run
```

**Example output:**
```
Triggering scan for series ID 42...
‚úì Scan triggered successfully
```

#### `schedule-mode` - Automatic periodic downloads

```bash
# Run with config file settings
python extrarrfin.py schedule-mode

# Override interval and unit
python extrarrfin.py schedule-mode --interval 30 --unit minutes

# With other options
python extrarrfin.py schedule-mode --interval 6 --unit hours --limit "Series Name"

# With episode targeting and verbose mode
python extrarrfin.py schedule-mode --limit "Series" --episode 5 --verbose

# Dry-run mode for testing
python extrarrfin.py schedule-mode --dry-run --interval 5 --unit minutes
```

Schedule mode will:
- Run immediately on start
- Execute downloads at the specified interval
- Continue running until stopped with Ctrl+C
- Display clear information about each execution and next run

**Example output:**
```
ExtrarrFin - Schedule Mode
Running downloads every 6 hours
Press Ctrl+C to stop

Running initial download...

============================================================
Running scheduled download at 2026-01-24 10:00:00
============================================================

Processing: Breaking Bad
  ...
  
Summary:
  Total: 2
  Success: 2
  Failed: 0

Next run in 6 hours
```

### Global options

```bash
# Use a specific configuration file
python extrarrfin.py --config /path/to/config.yaml list

# Specify Sonarr URL and API key directly
python extrarrfin.py --sonarr-url http://localhost:8989 --sonarr-api-key YOUR_KEY list

# Add Radarr for movie support
python extrarrfin.py --sonarr-url http://localhost:8989 --sonarr-api-key YOUR_SONARR_KEY \
  --radarr-url http://localhost:7878 --radarr-api-key YOUR_RADARR_KEY \
  --radarr-dir /movies download --mode tag

# Set log level
python extrarrfin.py --log-level DEBUG list

# Specify mapping directories
python extrarrfin.py --media-dir /mnt/media --sonarr-dir /tv download
```

**Available CLI options:**
- `--config PATH` - Path to configuration file (default: config.yaml)
- `--sonarr-url URL` - Sonarr URL
- `--sonarr-api-key KEY` - Sonarr API key
- `--radarr-url URL` - Radarr URL (optional, for movie support)
- `--radarr-api-key KEY` - Radarr API key (optional)
- `--radarr-dir PATH` - Radarr root directory (optional)
- `--jellyfin-url URL` - Jellyfin URL (optional)
- `--jellyfin-api-key KEY` - Jellyfin API key (optional)
- `--media-dir PATH` - Local media directory path
- `--sonarr-dir PATH` - Sonarr media directory path
- `--log-level LEVEL` - Logging level (DEBUG, INFO, WARNING, ERROR)
python extrarrfin.py --media-dir /mnt/media --sonarr-dir /tv download
```

## üéØ Common use cases

### Scenario 1: First use

```bash
# 1. Test connection
python extrarrfin.py test

# 2. List what would be downloaded
python extrarrfin.py download --dry-run

# 3. Download episodes
python extrarrfin.py download
```

### Scenario 2: Test with a series

```bash
# Limit to one series to test
python extrarrfin.py list --limit "Breaking Bad"
python extrarrfin.py download --limit "Breaking Bad" --dry-run
python extrarrfin.py download --limit "Breaking Bad"
```

### Scenario 3: Remote execution

If you're running the script on a different machine than Sonarr:

```bash
# Configure mapping in config.yaml
# sonarr_directory: "/tv"
# media_directory: "/mnt/nas/media/TV Shows"

python extrarrfin.py download
```

### Scenario 4: Re-download files

```bash
# Force re-download
python extrarrfin.py download --limit "Series Name" --force
```

### Scenario 5: Jellyfin integration

```bash
# Download with automatic Jellyfin library refresh
python extrarrfin.py download --jellyfin-url http://localhost:8096 --jellyfin-api-key YOUR_KEY

# Or configure in config.yaml and run normally
python extrarrfin.py download
```

### Scenario 6: Download movie extras (Radarr)

```bash
# Tag movies in Radarr with "want-extras" tag
# Then run in tag mode
python extrarrfin.py download --mode tag

# Test with a single movie
python extrarrfin.py list --mode tag --limit "Inception"
python extrarrfin.py download --mode tag --limit "Inception" --dry-run
python extrarrfin.py download --mode tag --limit "Inception"

# Download extras for both series AND movies
python extrarrfin.py download --mode tag
```

### Scenario 7: Mixed workflow (Season 0 + Extras)

```bash
# Download Season 0 for series + extras for tagged series/movies
python extrarrfin.py download --mode season0 --mode tag

# Or configure in config.yaml
# mode: ["season0", "tag"]
python extrarrfin.py download
```

## üì∫ Jellyfin Integration

ExtrarrFin can automatically refresh your Jellyfin library after downloading new episodes, ensuring your media server immediately recognizes new content without manual intervention.

### Configuration

Add Jellyfin credentials to your `config.yaml`:

```yaml
# Jellyfin server URL
jellyfin_url: "http://localhost:8096"

# Jellyfin API key (generated in Dashboard ‚Üí API Keys)
jellyfin_api_key: "your_jellyfin_api_key_here"
```

Or use environment variables:

```bash
export JELLYFIN_URL="http://localhost:8096"
export JELLYFIN_API_KEY="your_jellyfin_api_key_here"
```

Or pass as command-line arguments:

```bash
python extrarrfin.py download --jellyfin-url http://localhost:8096 --jellyfin-api-key YOUR_KEY
```

### How it works

1. **Automatic refresh**: After successfully downloading episodes, ExtrarrFin triggers a full library scan
2. **Smart behavior**: 
   - Refresh only happens when at least one episode is successfully downloaded
   - Skipped in dry-run mode to avoid unnecessary scans
   - Falls back gracefully if Jellyfin is not configured or unreachable
3. **Test connectivity**: Use `python extrarrfin.py test` to verify your Jellyfin connection

### Getting your Jellyfin API Key

1. Open your Jellyfin web interface
2. Go to **Dashboard** ‚Üí **API Keys**
3. Click **+** to create a new API key
4. Give it a name (e.g., "ExtrarrFin")
5. Copy the generated key and add it to your configuration

### Example output

```
Processing: Breaking Bad
  ...
  ‚úì Downloaded: Breaking Bad - S00E01 - Pilot.mp4
  ‚úì Downloaded: Breaking Bad - S00E02 - Inside Breaking Bad.mp4

Refreshing Jellyfin library...
‚úì Jellyfin library refresh triggered

Summary:
  Total: 2
  Success: 2
  Failed: 0
```

### Troubleshooting

If Jellyfin refresh fails:
- Verify your Jellyfin URL is accessible
- Check that your API key is valid
- Ensure Jellyfin is running and responsive
- Run `python extrarrfin.py test` to diagnose connection issues

**Note**: Jellyfin integration is completely optional. If not configured, ExtrarrFin will work normally without library refresh functionality.

## üìÅ File structure

Downloaded files are organized according to Jellyfin format:

```
/path/to/series/
‚îî‚îÄ‚îÄ Specials/
    ‚îú‚îÄ‚îÄ Series Name - S00E01 - Episode Title.mp4
    ‚îú‚îÄ‚îÄ Series Name - S00E02 - Episode Title.mp4
    ‚îî‚îÄ‚îÄ ...
```

Naming format: `{SeriesName} - S{Season:02d}E{Episode:02d} - {EpisodeTitle}.{ext}`

## ÔøΩ Subtitle Management

ExtrarrFin automatically downloads and manages subtitles from YouTube videos:

### Features

- **Auto-download**: Subtitles are automatically downloaded when available
- **Multiple languages**: Configure priority languages (default: French and English)
- **Smart fallback**: Uses manual subtitles first, then auto-generated if needed
- **Format conversion**: All subtitles are converted to SRT format for maximum compatibility
- **Embedded + External**: Subtitles are both embedded in the video file and saved as separate .srt files

### Configuration

```yaml
# Download specific languages (in priority order)
subtitle_languages:
  - "fr"          # French
  - "en"          # English
  - "fr-FR"       # French (France)
  - "en-US"       # English (US)
  - "en-GB"       # English (UK)
  - "de"          # German
  - "es"          # Spanish
  - "it"          # Italian
  - "pt"          # Portuguese

# Or download ALL available subtitles
download_all_subtitles: false  # Set to true to download all
```

### How it works

1. **Priority mode** (default): Downloads only specified languages
   - Tries manual subtitles first
   - Falls back to auto-generated if manual not available
   - Downloads in the order specified in `subtitle_languages`

2. **All subtitles mode**: When `download_all_subtitles: true`
   - Downloads every available subtitle language
   - Useful for international content
   - May result in larger storage usage

### Language codes

Use ISO 639-1 codes or with regional variants:
- Simple: `fr`, `en`, `de`, `es`, `it`, `pt`, `ja`, `ko`, `zh`
- Regional: `en-US`, `en-GB`, `fr-FR`, `fr-CA`, `es-ES`, `es-MX`, `pt-BR`, `pt-PT`

### Examples

**For French content with English fallback:**
```yaml
subtitle_languages: ["fr", "fr-FR", "en"]
```

**For international viewing:**
```yaml
download_all_subtitles: true
```

**For specific multi-language setup:**
```yaml
subtitle_languages: ["fr", "en", "es", "de", "it"]
download_all_subtitles: false
```

### Output

Subtitles are saved both:
- **Embedded**: Inside the video file (for apps that support it)
- **External**: As separate `.srt` files (e.g., `Series - S00E01.fr.srt`, `Series - S00E01.en.srt`)

This ensures maximum compatibility with Jellyfin, Plex, and other media servers.

## üì∫ STRM File Mode (Streaming Mode)

ExtrarrFin can create **STRM files** instead of downloading videos, allowing your media server to stream directly from YouTube.

### What are STRM files?

STRM (Stream) files are simple text files containing a URL. When your media server encounters a `.strm` file, it streams the content from that URL instead of playing a local file.

### Benefits

‚úÖ **Saves disk space**: No need to download large video files  
‚úÖ **Always up-to-date**: Content streamed directly from source  
‚úÖ **Faster setup**: Instant "download" - just creates small text files  
‚úÖ **Perfect for specials**: Ideal for one-time viewing content  
‚úÖ **Subtitles included**: External .srt files are downloaded alongside the .strm file

### Limitations

‚ö†Ô∏è **Requires internet**: Playback needs active internet connection  
‚ö†Ô∏è **YouTube availability**: Content must remain available on YouTube  
‚ö†Ô∏è **Media server support**: Not all media servers support STRM files equally  
‚ö†Ô∏è **Quality depends on YouTube**: Can't control video quality as precisely  
üî¥ **URL expiration**: YouTube stream URLs expire after ~6 hours  
üî¥ **Requires periodic refresh**: Must re-run with `--force` flag every 6 hours to regenerate URLs  
üî¥ **IP-signed URLs**: Stream URLs are signed for the server's IP address - clients with different IPs cannot play the stream

### Configuration

Enable STRM mode in your configuration:

```yaml
# Create .strm files instead of downloading videos
use_strm_files: true
```

Or via environment variable:

```bash
export USE_STRM_FILES=true
```

Or with Docker:

```bash
docker run -e USE_STRM_FILES=true ...
```

### How it works

When STRM mode is enabled:

1. üîç ExtrarrFin searches YouTube for the episode
2. üìù Creates a `.strm` file containing the YouTube URL
3. ÔøΩ Downloads subtitles as separate `.srt` files (configurable languages)
4. üíæ Saves as: `Series Name - S00E01 - Episode Title.strm` (+ `.fr.srt`, `.en.srt`, etc.)
5. üìÅ Places in `/path/to/series/Specials/` folder
6. üîÑ Triggers Sonarr rescan

### Example

**Normal mode** (downloads video):
```
Breaking Bad/Specials/
‚îî‚îÄ‚îÄ Breaking Bad - S00E01 - Pilot.mp4  (1.2 GB)
```

**STRM mode** (creates link + subtitles):
```
Breaking Bad/Specials/
‚îú‚îÄ‚îÄ Breaking Bad - S00E01 - Pilot.strm  (50 bytes)
‚îú‚îÄ‚îÄ Breaking Bad - S00E01 - Pilot.fr.srt  (25 KB)
‚îî‚îÄ‚îÄ Breaking Bad - S00E01 - Pilot.en.srt  (23 KB)
```

Content of `.strm` file:
```
https://www.youtube.com/watch?v=dQw4w9WgXcQ
```

### Media Server Compatibility

| Media Server | STRM Support | Notes |
|-------------|--------------|-------|
| **Jellyfin** | ‚úÖ Excellent | Full support, works great |
| **Plex** | ‚ö†Ô∏è Limited | Requires Plex Pass, may be unstable |
| **Emby** | ‚úÖ Good | Supported with some limitations |
| **Kodi** | ‚úÖ Excellent | Native support |

### When to use STRM mode?

**Good use cases:**
- üì¶ Limited disk space
- üé¨ One-time viewing specials (behind-the-scenes, interviews)
- üß™ Testing before committing disk space
- üì∫ Content that changes frequently

**Not recommended for:**
- üì∫ Main series episodes you want to keep
- üö´ Areas with unreliable internet
- üéØ Content requiring specific quality/subtitles
- üíæ Long-term archiving
- ‚è∞ Content you watch repeatedly (URLs expire every ~6h)
- üåê Remote users (URLs are IP-signed for server only)

### Maintaining STRM files

Since YouTube stream URLs expire after approximately 6 hours, you need to periodically refresh your STRM files:

**Manual refresh:**
```bash
# Regenerate all STRM files with fresh URLs
python extrarrfin.py download --force
```

**Automated refresh (recommended):**
```bash
# Add to crontab to refresh every 4 hours
0 */4 * * * cd /path/to/extrarrfin && python extrarrfin.py download --no-scan
```

**Important notes:**
- üîÑ The `--force` flag will overwrite existing STRM files with new URLs
- ‚è∞ Refresh before URLs expire (recommended: every 4-5 hours)
- üåê Stream URLs are IP-signed: only the server IP that generated the STRM can play it
- ‚ö†Ô∏è **This means remote clients cannot stream** - STRM mode only works when streaming from the same server/IP
- üìç Consider downloading MP4 files instead if you have remote users

### Mixed mode usage

You can switch between modes at any time:

```bash
# Download some series normally
python extrarrfin.py download --limit "Series A"

# Use STRM for others (edit config.yaml: use_strm_files: true)
python extrarrfin.py download --limit "Series B"
```

### Switching between modes

If you want to convert existing files from one mode to another, use the `--force` flag:

```bash
# Previously downloaded as MP4, now want STRM
# 1. Enable STRM mode in config.yaml
use_strm_files: true

# 2. Force re-download (will delete old MP4 and create STRM + subtitles)
python extrarrfin.py download --force --limit "Series Name"
```

**What happens with `--force`:**
- ‚úÖ Deletes existing video files (.mp4, .mkv, etc.)
- ‚úÖ Deletes existing .strm files
- ‚úÖ Keeps and regenerates subtitle files (.srt)
- ‚úÖ Creates the new file format based on current `use_strm_files` setting

**Note:** Subtitle files are always refreshed to match your current `subtitle_languages` configuration.

## üîß Directory mapping

If you're running the script on a different machine than Sonarr, you need to configure mapping:

- **`sonarr_directory`**: The path as configured in Sonarr (e.g. `/tv`)
- **`media_directory`**: The actual path on your machine (e.g. `/mnt/nas/media/TV Shows`)

The script will automatically convert paths.

## üêõ Troubleshooting

### Problem: "Missing configuration"
and uses intelligent scoring to find matches.

If videos are not found, check that:
- Episode names in Sonarr are accurate
- The content exists on YouTube
- Your `min_score` threshold isn't too high (try lowering to 40-45)
- Your network can access YouTube

**Debugging steps:**
```bash
# Use verbose mode to see scoring details
python extrarrfin.py download --limit "Series Name" --verbose --dry-run

# Try with lower minimum score
min_score: 40.0

# Increase number of results analyzed
youtube_search_results: 15
```

üìñ **See [SCORING.md](SCORING.md)** for detailed troubleshooting and configuration guid
### Problem: "No video found on YouTube"

**Solution**: The tool searches YouTube in two steps:
1. First with "series name + episode name"
2. Then with "episode name only" if the first search fails

If videos are still not found, check that:
- Episode names in Sonarr are accurate
- The content exists on YouTube
- Your network can access YouTube

### Problem: Sonarr connection error

**Solution**: Verify that:
- Sonarr URL is correct (with port)
- API key is valid (Settings > General in Sonarr)
- Sonarr is accessible from your machine

```bash
# Test connection
python extrarrfin.py test
```

### Problem: FFmpeg not found

**Solution**: Install FFmpeg:

```bash
# Ubuntu/Debian
sudo apt install ffmpeg

# macOS
brew install ffmpeg
```

### Problem: Incorrect file paths

**Solution**: Configure directory mapping:

```yaml
media_directory: "/your/real/path"
sonarr_directory: "/path/in/sonarr"
```

## üìù Advanced examples

### Schedule mode with systemd

```bash
# Create a systemd service file
sudo nano /etc/systemd/system/extrarrfin.service
```

```ini
[Unit]
Description=ExtrarrFin Schedule Mode
After=network.target

[Service]
Type=simple
User=your-user
WorkingDirectory=/home/user/extrarrfin
ExecStart=/usr/bin/python3 /home/user/extrarrfin/extrarrfin.py --config /home/user/extrarrfin/config.yaml schedule-mode
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

```bash
# Enable and start the service
sudo systemctl enable extrarrfin
sudo systemctl start extrarrfin
sudo systemctl status extrarrfin
```

### Automation with cron (one-time runs)

```bash
# Run every day at 2 AM
0 2 * * * cd /home/user/extrarrfin && /usr/bin/python3 extrarrfin.py --config config.yaml download >> /var/log/extrarrfin.log 2>&1
```

### Wrapper script

```bash
#!/bin/bash
# extrarrfin-wrapper.sh

cd /home/user/extrarrfin
source venv/bin/activate
python extrarrfin.py download --log-level INFO
deactivate
```

## üê≥ Docker Usage

### Quick start with Docker

```bash
# Pull the image from Docker Hub
docker pull jeanmary/extrarrfin:latest

# Test connection
docker run --rm \
  -v $(pwd)/config.yaml:/config/config.yaml \
  jeanmary/extrarrfin:latest --config /config/config.yaml test

# List series
docker run --rm \
  -v $(pwd)/config.yaml:/config/config.yaml \
  jeanmary/extrarrfin:latest --config /config/config.yaml list

# Download episodes (one-time)
docker run --rm \
  -v $(pwd)/config.yaml:/config/config.yaml \
  -v /path/to/media:/media \
  jeanmary/extrarrfin:latest --config /config/config.yaml download
```

### Docker Compose (recommended for schedule mode)

1. Create a `config` directory and copy your configuration:

```bash
mkdir config
cp config.yaml config/
```

2. Edit `docker-compose.yml` to adjust paths and settings:

```yaml
version: '3.8'

services:
  extrarrfin:
    image: jeanmary/extrarrfin:latest
    container_name: extrarrfin
    restart: unless-stopped
    volumes:
      - ./config:/config
      - /path/to/your/media:/media
    environment:
      # Sonarr (required for series)
      - SONARR_URL=http://sonarr:8989
      - SONARR_API_KEY=your_api_key_here
      - SONARR_DIRECTORY=/media
      
      # Radarr (optional for movies)
      - RADARR_URL=http://radarr:7878
      - RADARR_API_KEY=your_radarr_api_key_here
      - RADARR_DIRECTORY=/media
      
      # Jellyfin (optional)
      - JELLYFIN_URL=http://jellyfin:8096
      - JELLYFIN_API_KEY=your_jellyfin_api_key_here
      
      # Media directory
      - MEDIA_DIRECTORY=/media
      
      # Subtitle configuration (optional)
      - SUBTITLE_LANGUAGES=fr,en,fr-FR,en-US,en-GB
      - DOWNLOAD_ALL_SUBTITLES=false
      
      # STRM file mode (optional) - set to true to stream instead of download
      - USE_STRM_FILES=false
    command: ["--config", "/config/config.yaml", "schedule-mode"]
    networks:
      - media

networks:
  media:
    external: true
    name: your_existing_network
```

3. Start the container:

```bash
# Start in detached mode
docker-compose up -d

# View logs
docker-compose logs -f

# Stop
docker-compose down
```

### Docker environment variables

You can override config with environment variables:

```bash
docker run --rm \
  -e SONARR_URL=http://sonarr:8989 \
  -e SONARR_API_KEY=your_sonarr_key \
  -e RADARR_URL=http://radarr:7878 \
  -e RADARR_API_KEY=your_radarr_key \
  -e JELLYFIN_URL=http://jellyfin:8096 \
  -e JELLYFIN_API_KEY=your_jellyfin_key \
  -e MEDIA_DIRECTORY=/media \
  -e SUBTITLE_LANGUAGES=fr,en,es \
  -e DOWNLOAD_ALL_SUBTITLES=false \
  -e USE_STRM_FILES=false \
  -v /path/to/media:/media \
  jeanmary/extrarrfin:latest download
```

Available environment variables:
- `SONARR_URL`: Sonarr instance URL (required)
- `SONARR_API_KEY`: Sonarr API key (required)
- `RADARR_URL`: Radarr instance URL (optional, for movies)
- `RADARR_API_KEY`: Radarr API key (optional)
- `JELLYFIN_URL`: Jellyfin server URL (optional)
- `JELLYFIN_API_KEY`: Jellyfin API key (optional)
- `MEDIA_DIRECTORY`: Path to media directory
- `SONARR_DIRECTORY`: Sonarr root directory path
- `RADARR_DIRECTORY`: Radarr root directory path
- `SUBTITLE_LANGUAGES`: Comma-separated language codes (e.g., `fr,en,de,es`)
- `DOWNLOAD_ALL_SUBTITLES`: Set to `true` to download all available subtitles
- `USE_STRM_FILES`: Set to `true` to create STRM files instead of downloading videos

### Docker with existing Sonarr/Radarr network

If Sonarr/Radarr is already running in Docker:

```bash
# Find Sonarr's network
docker network ls

# Use the same network in docker-compose.yml
networks:
  media:
    external: true
    name: sonarr_radarr_network_name
```

## ü§ù Contributing

Contributions are welcome! Feel free to:

1. Fork the project
2. Create a branch (`git checkout -b feature/improvement`)
3. Commit your changes (`git commit -am 'Add feature'`)
4. Push to the branch (`git push origin feature/improvement`)
5. Open a Pull Request

## üìÑ License

This project is licensed under the MIT License. See the `LICENSE` file for more details.

## ‚ö†Ô∏è Disclaimer

This tool downloads content from YouTube. Make sure to respect:
- YouTube's Terms of Service
- Copyright laws in your country
- Sonarr/Radarr Terms of Service

Use this tool responsibly and only for content you have the rights to.

## üôè Acknowledgments

- [Sonarr](https://sonarr.tv/) - The TV series manager
- [Radarr](https://radarr.video/) - The movie manager
- [yt-dlp](https://github.com/yt-dlp/yt-dlp) - The YouTube downloader
- [Click](https://click.palletsprojects.com/) - The CLI library
- [Rich](https://github.com/Textualize/rich) - Terminal display

## üìû Support

For any questions or issues:
- üìñ Check the [SCORING.md](SCORING.md) documentation for video matching issues
- üè∑Ô∏è Check the [TAG_MODE.md](TAG_MODE.md) documentation for tag-based downloads
- üêõ Open an issue on GitHub
- üìö Check Sonarr/Radarr documentation
- üîç Check logs with `--log-level DEBUG`

---

**Made with ‚ù§Ô∏è for the *arr community**
